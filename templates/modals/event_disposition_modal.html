<!-- ============================================================
     FORD-CAD — EVENT DISPOSITION MODAL
     Phase-3 Canonical (codes driven by backend)
============================================================ -->

<div class="cad-modal-overlay" onclick="CAD_MODAL.close()"></div>

<div class="cad-modal disposition-modal event-disposition-modal" id="event-disposition-modal">

    <!-- ========================================================
         HEADER
    ======================================================== -->
    <div class="modal-header">
        <div class="modal-title">Event Disposition</div>
        <div class="modal-subtitle">Incident #{{ incident_id }}</div>
        <div class="modal-close" onclick="CAD_MODAL.close()">✖</div>
    </div>

    <!-- ========================================================
         DISPATCHER IDENTITY
    ======================================================== -->
    {% include "modals/dispatcher_identity_block.html" %}

    <!-- ========================================================
         FORM BODY
    ======================================================== -->
    <div class="modal-body">
        <form id="dispositionForm"
              onsubmit="event.preventDefault(); DISP.submit({{ incident_id }});">

            {% set CODES = valid_codes if valid_codes is defined else outcomes %}

            <!-- DISPOSITION CODE -->
            <div class="modal-field">
                <label class="modal-label">Disposition Code</label>
                <select class="modal-select" id="disp-code" name="code" required>
                    <option value="">-- Select Code --</option>
                    {% for code, label in CODES|dictsort %}
                        <option value="{{ code }}">{{ code }} — {{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- NARRATIVE DESCRIPTION -->
            <div class="modal-field">
                <label class="modal-label">Narrative (Required)</label>
                <textarea class="modal-textarea"
                          id="disp-comment"
                          name="comment"
                          placeholder="Enter disposition narrative..."
                          required></textarea>
            </div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button type="submit" class="pill-btn modal-submit-btn">
                    Submit Disposition
                </button>

                <button type="button"
                        onclick="CAD_MODAL.close()"
                        class="pill-btn modal-cancel-btn">
                    Cancel
                </button>
            </div>

        </form>
    </div>

</div>
