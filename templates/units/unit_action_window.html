<!-- ============================================================
     FORD CAD — UNIT ACTION POPUP (SMALL / COMMAND MENU)
     templates/units/unit_action_window.html
============================================================ -->

<!-- Modal Overlay -->
<div class="cad-modal-overlay" onclick="CAD_MODAL.close()"></div>

<!-- Small UAW Modal -->
<div class="cad-modal uaw-mini-modal" id="uaw-mini-modal">

  <div class="uaw-mini-header" onmousedown="UAW.startDrag?.(event)">
    <div class="uaw-mini-title">
      Unit {{ unit.unit_id }}
    </div>

    <button class="uaw-mini-close" onclick="CAD_MODAL.close()" title="Close">✕</button>
  </div>

  <div class="uaw-mini-body">

    <div class="uaw-mini-meta">
      <div class="meta-row">
        <span class="lbl">Role</span>
        <span class="val">{{ unit.role or "—" }}</span>
      </div>

      <div class="meta-row">
        <span class="lbl">Status</span>
        <span class="val">{{ unit.status or "—" }}</span>
      </div>

      {% if active_incident_id %}
      <div class="meta-row">
        <span class="lbl">Incident</span>
        <span class="val">#{{ active_incident_id }}</span>
      </div>
      {% endif %}
    </div>

    {% if active_incident_id %}
      <div class="uaw-mini-actions">
        <button class="cad-btn" onclick="UAW.updateStatus('{{ unit.unit_id }}', '{{ active_incident_id }}', 'ENROUTE')">Enroute</button>
        <button class="cad-btn" onclick="UAW.updateStatus('{{ unit.unit_id }}', '{{ active_incident_id }}', 'ARRIVED')">Arrived</button>
        <button class="cad-btn" onclick="UAW.updateStatus('{{ unit.unit_id }}', '{{ active_incident_id }}', 'OPERATING')">Operating</button>
        <button class="cad-btn danger" onclick="UAW.updateStatus('{{ unit.unit_id }}', '{{ active_incident_id }}', 'CLEAR')">Clear</button>
      </div>
    {% else %}
      <div class="uaw-mini-hint">
        No active incident for this unit yet.<br>
        Dispatch the unit to an incident first (via IAW / picker), then status buttons will work.
      </div>
    {% endif %}

    <div class="uaw-mini-footer">
      <button class="cad-btn" onclick="MessagingUI.openDM('{{ unit.unit_id }}')" title="Send message to {{ unit.unit_id }}">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px">
          <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
        </svg>
        Message Unit
      </button>
      <button class="cad-btn secondary" onclick="UAW.openDetails('{{ unit.unit_id }}')">Full Unit Details</button>
      <button class="cad-btn secondary" onclick="CAD_MODAL.close()">Close</button>
    </div>

  </div>
</div>
